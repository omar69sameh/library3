<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive 3D Book</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            overflow: hidden;
            background: linear-gradient(135deg, #2c1810 0%, #1a0f08 100%);
            cursor: none;
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #cursor {
            position: fixed;
            width: 40px;
            height: 40px;
            pointer-events: none;
            z-index: 10000;
            transform: translate(-50%, -50%) rotate(-45deg);
            transition: transform 0.1s ease;
        }

        #cursor img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .table-surface {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, rgba(101,67,33,0.1) 1px, transparent 1px),
                linear-gradient(rgba(101,67,33,0.1) 1px, transparent 1px),
                linear-gradient(135deg, #8B4513 0%, #654321 50%, #5C4033 100%);
            background-size: 120px 120px, 120px 120px, 100% 100%;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.5);
        }

        .table-surface::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(90deg, 
                    transparent, 
                    transparent 2px, 
                    rgba(0,0,0,0.03) 2px, 
                    rgba(0,0,0,0.03) 4px);
            opacity: 0.6;
        }

        .book-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            perspective: 2000px;
            perspective-origin: 50% 50%;
            width: 1100px;
            height: 480px;
            transition: transform 0.3s ease;
        }

        .book {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transform: rotateX(10deg) rotateY(0deg) rotateZ(0deg);
            transition: transform 0.3s ease;
            animation: breathe 4s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: rotateX(10deg) translateY(0px) scale(1); }
            50% { transform: rotateX(10deg) translateY(-5px) scale(1.005); }
        }

        .book-base {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #f4e8d8;
            border-radius: 4px;
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.6),
                inset 0 0 20px rgba(0,0,0,0.1),
                inset 2px 0 5px rgba(0,0,0,0.2);
        }

        .book-base::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            width: 20px;
            height: 100%;
            background: linear-gradient(90deg, 
                rgba(0,0,0,0.3) 0%, 
                rgba(0,0,0,0.1) 50%, 
                transparent 100%);
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .book-base::after {
            content: '';
            position: absolute;
            right: 0;
            top: 5px;
            width: 8px;
            height: calc(100% - 10px);
            background: repeating-linear-gradient(
                0deg,
                #fff 0px,
                #f9f9f9 1px,
                #f0f0f0 2px,
                #fff 3px
            );
            box-shadow: -2px 0 5px rgba(0,0,0,0.2);
        }

        .pages-container {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
        }

        .page-spread {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            opacity: 0;
            pointer-events: none;
            transition: none;
            visibility: hidden;
        }

        .page-spread.active {
            opacity: 1;
            pointer-events: auto;
            z-index: 1;
            visibility: visible;
        }

        .page-spread.transitioning {
            opacity: 0;
            visibility: hidden;
        }

        .page-left,
        .page-right {
            position: absolute;
            width: 50%;
            height: 100%;
            background: 
                radial-gradient(ellipse at center, rgba(255,255,255,0.1) 0%, transparent 70%),
                linear-gradient(135deg, #fdfbf7 0%, #f9f6f0 100%);
            padding: 60px 50px;
            overflow: hidden;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.05);
        }

        .page-left {
            left: 0;
            border-right: 1px solid rgba(0,0,0,0.1);
            background-image: 
                radial-gradient(ellipse at 100% 50%, rgba(0,0,0,0.15) 0%, transparent 50%),
                linear-gradient(135deg, #fdfbf7 0%, #f9f6f0 100%);
        }

        .page-right {
            right: 0;
            border-left: 1px solid rgba(0,0,0,0.1);
            background-image: 
                radial-gradient(ellipse at 0% 50%, rgba(0,0,0,0.15) 0%, transparent 50%),
                linear-gradient(135deg, #f9f6f0 0%, #fdfbf7 100%);
        }

        .page-left::before,
        .page-right::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.01) 2px, rgba(0,0,0,0.01) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0,0,0,0.01) 2px, rgba(0,0,0,0.01) 4px);
            pointer-events: none;
        }

        .page-content h1 {
            font-size: 48px;
            color: #2c1810;
            margin-bottom: 20px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .page-content h2 {
            font-size: 32px;
            color: #3d2415;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .page-content h3 {
            font-size: 24px;
            color: #4a2f1a;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .page-content p {
            font-size: 16px;
            line-height: 1.8;
            color: #3d2415;
            margin-bottom: 15px;
        }

        .page-content ul {
            list-style: none;
            padding-left: 0;
        }

        .page-content li {
            font-size: 15px;
            color: #4a2f1a;
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .page-content li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: #8B4513;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .gallery-item {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #e8d5c0 0%, #d4bfa8 100%);
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #5c4033;
        }

        .categories {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .category-card {
            background: rgba(139, 69, 19, 0.1);
            padding: 15px 20px;
            border-radius: 6px;
            border-left: 4px solid #8B4513;
        }

        .category-card h4 {
            font-size: 18px;
            color: #2c1810;
            margin-bottom: 5px;
        }

        .category-card p {
            font-size: 14px;
            margin: 0;
        }

        .features-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .feature-item {
            display: flex;
            align-items: start;
            gap: 15px;
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background: #8B4513;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }

        .feature-text h4 {
            font-size: 18px;
            color: #2c1810;
            margin-bottom: 5px;
        }

        .feature-text p {
            font-size: 14px;
            margin: 0;
        }

        .contact-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .contact-form input,
        .contact-form textarea {
            padding: 12px;
            border: 2px solid #d4bfa8;
            border-radius: 4px;
            font-family: Georgia, serif;
            font-size: 14px;
            background: rgba(255,255,255,0.5);
            cursor: none;
        }

        .contact-form input:focus,
        .contact-form textarea:focus {
            outline: none;
            border-color: #8B4513;
        }

        .contact-form button {
            padding: 12px 24px;
            background: #8B4513;
            color: white;
            border: none;
            border-radius: 4px;
            font-family: Georgia, serif;
            font-size: 16px;
            cursor: none;
            transition: background 0.3s;
        }

        .contact-form button:hover {
            background: #6d3410;
        }

        .nav-arrow {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: rgba(139, 69, 19, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: none;
            transition: all 0.3s;
            z-index: 100;
            opacity: 0.7;
        }

        .nav-arrow:hover {
            opacity: 1;
            transform: translateY(-50%) scale(1.1);
        }

        .nav-arrow.left {
            left: 30px;
        }

        .nav-arrow.right {
            right: 30px;
        }

        .nav-arrow.disabled {
            opacity: 0.2;
            pointer-events: none;
        }

        .page-indicator {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 100;
        }

        .indicator-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(139, 69, 19, 0.3);
            cursor: none;
            transition: all 0.3s;
        }

        .indicator-dot.active {
            background: #8B4513;
            transform: scale(1.3);
        }

        .flipping-page {
            position: absolute;
            top: 0;
            left: 50%;
            width: 50%;
            height: 100%;
            background: linear-gradient(135deg, #fdfbf7 0%, #f9f6f0 100%);
            transform-origin: left center;
            transform-style: preserve-3d;
            backface-visibility: hidden;
            pointer-events: none;
            box-shadow: -5px 0 20px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .flipping-page::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f9f6f0 0%, #fdfbf7 100%);
            transform: rotateY(180deg);
            backface-visibility: hidden;
        }

        @media (max-width: 900px) {
            body {
                overflow: hidden;
            }

            .book-container {
                width: 90vw;
                height: 55vh;
                max-width: 100%;
                max-height: 450px;
            }

            .book {
                height: 100%;
                animation: none;
            }

            .page-left,
            .page-right {
                padding: 20px 15px;
                overflow-y: auto;
                overflow-x: hidden;
            }

            .page-content {
                height: 100%;
                display: flex;
                flex-direction: column;
            }

            .page-content h1 {
                font-size: 24px;
                margin-bottom: 12px;
            }

            .page-content h2 {
                font-size: 20px;
                margin-bottom: 10px;
            }

            .page-content h3 {
                font-size: 18px;
                margin-bottom: 8px;
            }

            .page-content p,
            .page-content li {
                font-size: 12px;
                line-height: 1.6;
                margin-bottom: 10px;
            }

            .gallery-grid {
                grid-template-columns: 1fr;
                gap: 10px;
                margin-top: 10px;
            }

            .gallery-item {
                aspect-ratio: 2/1;
                font-size: 12px;
            }

            .categories {
                gap: 10px;
                margin-top: 10px;
            }

            .category-card {
                padding: 10px 12px;
            }

            .category-card h4 {
                font-size: 14px;
            }

            .category-card p {
                font-size: 11px;
            }

            .features-list {
                gap: 12px;
                margin-top: 10px;
            }

            .feature-icon {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }

            .feature-text h4 {
                font-size: 14px;
            }

            .feature-text p {
                font-size: 11px;
            }

            .contact-form {
                gap: 10px;
                margin-top: 10px;
            }

            .contact-form input,
            .contact-form textarea {
                padding: 8px;
                font-size: 12px;
            }

            .contact-form button {
                padding: 10px 20px;
                font-size: 14px;
            }

            #cursor {
                display: none;
            }

            body {
                cursor: auto;
            }

            .contact-form input,
            .contact-form textarea,
            .contact-form button {
                cursor: pointer;
            }

            .nav-arrow,
            .page-indicator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="cursor">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%238B4513' stroke-width='2'%3E%3Cpath d='M12 19l7-7 3 3-7 7-3-3z'/%3E%3Cpath d='M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z'/%3E%3Cpath d='M2 2l7.586 7.586'/%3E%3Ccircle cx='11' cy='11' r='2'/%3E%3C/svg%3E" alt="Pen cursor">
    </div>

    <div class="table-surface"></div>

    <div class="book-container">
        <div class="book">
            <div class="book-base"></div>
            
            <div class="pages-container">
                <div class="page-spread active" data-page="0">
                    <div class="page-left">
                        <div class="page-content">
                            <h1>Welcome</h1>
                            <p>Discover a world of creativity and innovation through our interactive experience. Turn the pages to explore our story.</p>
                            <p>This immersive journey combines cutting-edge technology with timeless design principles.</p>
                        </div>
                    </div>
                    <div class="page-right">
                        <div class="page-content">
                            <h2>About Us</h2>
                            <p>We are passionate creators dedicated to crafting exceptional digital experiences that blend artistry with functionality.</p>
                            <p>Our team believes in pushing boundaries and exploring new possibilities in web design and interactive media.</p>
                            <p>Every project is an opportunity to tell a unique story and create lasting impressions.</p>
                        </div>
                    </div>
                </div>

                <div class="page-spread" data-page="1">
                    <div class="page-left">
                        <div class="page-content">
                            <h2>Categories</h2>
                            <div class="categories">
                                <div class="category-card">
                                    <h4>Design</h4>
                                    <p>Innovative visual solutions</p>
                                </div>
                                <div class="category-card">
                                    <h4>Development</h4>
                                    <p>Cutting-edge technology</p>
                                </div>
                                <div class="category-card">
                                    <h4>Strategy</h4>
                                    <p>Data-driven insights</p>
                                </div>
                                <div class="category-card">
                                    <h4>Creative</h4>
                                    <p>Bold artistic direction</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="page-right">
                        <div class="page-content">
                            <h2>Gallery</h2>
                            <div class="gallery-grid">
                                <div class="gallery-item">Project 1</div>
                                <div class="gallery-item">Project 2</div>
                                <div class="gallery-item">Project 3</div>
                                <div class="gallery-item">Project 4</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page-spread" data-page="2">
                    <div class="page-left">
                        <div class="page-content">
                            <h2>Key Features</h2>
                            <div class="features-list">
                                <div class="feature-item">
                                    <div class="feature-icon">1</div>
                                    <div class="feature-text">
                                        <h4>3D Interaction</h4>
                                        <p>Immersive spatial experiences</p>
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">2</div>
                                    <div class="feature-text">
                                        <h4>Responsive Design</h4>
                                        <p>Seamless across all devices</p>
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">3</div>
                                    <div class="feature-text">
                                        <h4>Performance</h4>
                                        <p>Optimized for speed</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="page-right">
                        <div class="page-content">
                            <h3>What Sets Us Apart</h3>
                            <p>Our commitment to excellence drives every decision we make. We combine technical expertise with creative vision to deliver outstanding results.</p>
                            <p>From concept to completion, we ensure every detail receives the attention it deserves.</p>
                            <ul>
                                <li>Award-winning team</li>
                                <li>Proven track record</li>
                                <li>Client-focused approach</li>
                                <li>Innovative solutions</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="page-spread" data-page="3">
                    <div class="page-left">
                        <div class="page-content">
                            <h2>Get In Touch</h2>
                            <p>Ready to start your next project? We'd love to hear from you.</p>
                            <p><strong>Email:</strong> hello@example.com</p>
                            <p><strong>Phone:</strong> +1 (555) 123-4567</p>
                            <p><strong>Address:</strong> 123 Creative Street, Design City, DC 12345</p>
                        </div>
                    </div>
                    <div class="page-right">
                        <div class="page-content">
                            <h3>Contact Form</h3>
                            <div class="contact-form">
                                <input type="text" placeholder="Your Name">
                                <input type="email" placeholder="Your Email">
                                <textarea rows="4" placeholder="Your Message"></textarea>
                                <button>Send Message</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flipping-page" style="display: none;"></div>
        </div>
    </div>

    <div class="nav-arrow left disabled">‹</div>
    <div class="nav-arrow right">›</div>

    <div class="page-indicator">
        <div class="indicator-dot active"></div>
        <div class="indicator-dot"></div>
        <div class="indicator-dot"></div>
        <div class="indicator-dot"></div>
    </div>

    <script>
        let currentPageIndex = 0;
        const spreads = document.querySelectorAll('.page-spread');
        const totalPages = spreads.length;
        let isAnimating = false;
        let direction = null;
        
        const gesture = {
            active: false,
            locked: false,
            lockType: null,
            startX: 0,
            startY: 0,
            lastX: 0,
            lastY: 0
        };
        
        const HORIZONTAL_LOCK_THRESHOLD = 10;
        const VERTICAL_LOCK_THRESHOLD = 10;
        const SWIPE_FLIP_THRESHOLD = 80;
        
        const book = document.querySelector('.book');
        const bookContainer = document.querySelector('.book-container');
        const leftArrow = document.querySelector('.nav-arrow.left');
        const rightArrow = document.querySelector('.nav-arrow.right');
        const indicators = document.querySelectorAll('.indicator-dot');
        const flippingPage = document.querySelector('.flipping-page');
        const cursor = document.getElementById('cursor');

        document.addEventListener('mousemove', (e) => {
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
        });

        document.addEventListener('mousemove', (e) => {
            if (window.innerWidth <= 768) return;
            
            const rect = bookContainer.getBoundingClientRect();
            const x = (e.clientX - rect.left) / rect.width;
            const y = (e.clientY - rect.top) / rect.height;
            
            const rotateY = (x - 0.5) * 15;
            const rotateX = (y - 0.5) * -10;
            
            book.style.transform = `rotateX(${10 + rotateX}deg) rotateY(${rotateY}deg)`;
        });

        function canGoNext() {
            return currentPageIndex < totalPages - 1 && !isAnimating;
        }

        function canGoPrev() {
            return currentPageIndex > 0 && !isAnimating;
        }

        function updateUI() {
            spreads.forEach((spread, index) => {
                if (isAnimating) {
                    spread.classList.remove('active');
                    spread.classList.add('transitioning');
                } else {
                    spread.classList.toggle('active', index === currentPageIndex);
                    spread.classList.remove('transitioning');
                }
            });
            
            leftArrow.classList.toggle('disabled', currentPageIndex === 0);
            rightArrow.classList.toggle('disabled', currentPageIndex === totalPages - 1);
            
            indicators.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentPageIndex);
            });
        }

        function startFlipAnimation(dir) {
            return new Promise((resolve) => {
                const activeSpread = spreads[currentPageIndex];
                if (!activeSpread) {
                    resolve();
                    return;
                }

                const whitePageContent = `
                    <div class="page-spread active">
                        <div class="page-left" style="background: linear-gradient(135deg, #fdfbf7 0%, #f9f6f0 100%);"></div>
                        <div class="page-right" style="background: linear-gradient(135deg, #f9f6f0 0%, #fdfbf7 100%);"></div>
                    </div>
                `;
                
                flippingPage.innerHTML = whitePageContent;
                flippingPage.style.display = 'block';
                flippingPage.style.transition = 'none';

                if (dir === 'next') {
                    flippingPage.style.left = '50%';
                    flippingPage.style.transformOrigin = 'left center';
                    flippingPage.style.transform = 'rotateY(0deg)';
                    flippingPage.style.boxShadow = '-5px 0 20px rgba(0,0,0,0.3)';
                } else {
                    flippingPage.style.left = '0';
                    flippingPage.style.transformOrigin = 'right center';
                    flippingPage.style.transform = 'rotateY(180deg)';
                    flippingPage.style.boxShadow = '5px 0 20px rgba(0,0,0,0.3)';
                }

                void flippingPage.offsetWidth;

                flippingPage.style.transition = 'transform 0.8s cubic-bezier(0.25, 0.1, 0.25, 1), box-shadow 0.8s ease';
                if (dir === 'next') {
                    flippingPage.style.transform = 'rotateY(-180deg)';
                    flippingPage.style.boxShadow = '-18px 0 35px rgba(0,0,0,0.55)';
                } else {
                    flippingPage.style.transform = 'rotateY(0deg)';
                    flippingPage.style.boxShadow = '-5px 0 20px rgba(0,0,0,0.3)';
                }

                function onEnd(e) {
                    if (e.target !== flippingPage) return;
                    flippingPage.removeEventListener('transitionend', onEnd);
                    flippingPage.style.display = 'none';
                    flippingPage.style.transition = 'none';
                    flippingPage.style.transform = '';
                    flippingPage.style.boxShadow = '';
                    flippingPage.innerHTML = '';
                    resolve();
                }

                flippingPage.addEventListener('transitionend', onEnd);
            });
        }

        async function requestFlip(dir) {
            if (isAnimating) return;
            if (dir === 'next' && !canGoNext()) return;
            if (dir === 'prev' && !canGoPrev()) return;

            isAnimating = true;
            direction = dir;
            updateUI();

            await startFlipAnimation(dir);

            if (dir === 'next') {
                currentPageIndex += 1;
            } else {
                currentPageIndex -= 1;
            }

            isAnimating = false;
            direction = null;
            
            updateUI();
        }

        leftArrow.addEventListener('click', () => {
            requestFlip('prev');
        });

        rightArrow.addEventListener('click', () => {
            requestFlip('next');
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                requestFlip('prev');
            } else if (e.key === 'ArrowRight') {
                requestFlip('next');
            }
        });

        indicators.forEach((dot, index) => {
            dot.addEventListener('click', () => {
                if (isAnimating || index === currentPageIndex) return;

                const steps = Math.abs(index - currentPageIndex);
                const dir = index > currentPageIndex ? 'next' : 'prev';

                (async () => {
                    for (let i = 0; i < steps; i++) {
                        await requestFlip(dir);
                    }
                })();
            });
        });

        let scrollTimeout;
        let lastScrollDelta = 0;

        document.addEventListener('wheel', (e) => {
            if (window.innerWidth <= 768) return;
            if (isAnimating) return;
            
            e.preventDefault();
            
            clearTimeout(scrollTimeout);
            lastScrollDelta += e.deltaY;
            
            scrollTimeout = setTimeout(() => {
                if (lastScrollDelta > 30 && canGoNext()) {
                    requestFlip('next');
                } 
                else if (lastScrollDelta < -30 && canGoPrev()) {
                    requestFlip('prev');
                }
                lastScrollDelta = 0;
            }, 50);
        }, { passive: false });

        function beginGesture(x, y) {
            if (isAnimating) return;
            gesture.active = true;
            gesture.locked = false;
            gesture.lockType = null;
            gesture.startX = gesture.lastX = x;
            gesture.startY = gesture.lastY = y;
        }

        function moveGesture(x, y) {
            if (!gesture.active) return;
            gesture.lastX = x;
            gesture.lastY = y;

            const dx = x - gesture.startX;
            const dy = y - gesture.startY;

            if (!gesture.locked) {
                if (Math.abs(dx) > HORIZONTAL_LOCK_THRESHOLD && Math.abs(dx) > Math.abs(dy)) {
                    gesture.locked = true;
                    gesture.lockType = 'horizontal';
                } else if (Math.abs(dy) > VERTICAL_LOCK_THRESHOLD && Math.abs(dy) > Math.abs(dx)) {
                    gesture.locked = true;
                    gesture.lockType = 'vertical';
                }
            }

            if (gesture.lockType === 'horizontal') {
                const clamped = Math.max(Math.min(dx, 150), -150);
                const tilt = (clamped / 150) * 8;
                book.style.transform = `
                    rotateX(10deg)
                    rotateY(${tilt}deg)
                `;
            }
        }

        async function endGesture() {
            if (!gesture.active) return;
            const dx = gesture.lastX - gesture.startX;

            if (gesture.lockType === 'horizontal' && !isAnimating) {
                if (dx < -SWIPE_FLIP_THRESHOLD && canGoPrev()) {
                    await requestFlip('prev');
                } 
                else if (dx > SWIPE_FLIP_THRESHOLD && canGoNext()) {
                    await requestFlip('next');
                }
            }

            gesture.active = false;
            gesture.locked = false;
            gesture.lockType = null;

            setTimeout(() => {
                book.style.transform = 'rotateX(10deg) rotateY(0deg)';
            }, 100);
        }

        bookContainer.addEventListener('mousedown', (e) => {
            if (window.innerWidth <= 768) return;
            beginGesture(e.clientX, e.clientY);
            bookContainer.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            moveGesture(e.clientX, e.clientY);
        });

        document.addEventListener('mouseup', () => {
            if (gesture.active) {
                endGesture();
                bookContainer.style.cursor = 'grab';
            }
        });

        bookContainer.addEventListener('touchstart', (e) => {
            const t = e.changedTouches[0];
            if (!t) return;
            beginGesture(t.clientX, t.clientY);
        });

        bookContainer.addEventListener('touchmove', (e) => {
            const t = e.changedTouches[0];
            if (!t) return;
            moveGesture(t.clientX, t.clientY);
        });

        bookContainer.addEventListener('touchend', () => {
            if (gesture.active) {
                endGesture();
            }
        });

        function checkResponsive() {
            if (window.innerWidth <= 768) {
                book.style.transform = 'rotateX(10deg) rotateY(0deg)';
                book.style.animation = 'none';

                spreads.forEach((spread, index) => {
                    spread.classList.toggle('active', index === currentPageIndex);
                });
            } else {
                book.style.animation = 'breathe 4s ease-in-out infinite';
                updateUI();
            }
        }

        updateUI();
        checkResponsive();
        window.addEventListener('resize', checkResponsive);

        const interactiveElements = document.querySelectorAll(
            '.nav-arrow, .indicator-dot, .contact-form button, .gallery-item, .category-card'
        );

        interactiveElements.forEach(el => {
            el.addEventListener('mouseenter', () => {
                cursor.style.transform = 'translate(-50%, -50%) rotate(-45deg) scale(1.2)';
            });
            
            el.addEventListener('mouseleave', () => {
                cursor.style.transform = 'translate(-50%, -50%) rotate(-45deg) scale(1)';
            });
        });

        const contactForm = document.querySelector('.contact-form');
        if (contactForm) {
            contactForm.addEventListener('submit', (e) => {
                e.preventDefault();
                alert('Thank you for your message! We will get back to you soon.');
                contactForm.reset();
            });
        }

        console.log('Interactive 3D Book initialized successfully');
        console.log('Navigation: Arrow keys, mouse drag, or click arrows');
        console.log('Total pages:', totalPages);
    </script>
</body>
</html>